<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Happy Chocolate Day!</title>
  <link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@700&display=swap" rel="stylesheet">
  <!-- GSAP for smooth, high-performance animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    /* Reset & body styling */
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #fff1e6, #ffe4d1);
      font-family: sans-serif;
      overflow: hidden;
    }
    /* Container for the entire animation */
    #animation-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    /* Gold foil wrapper styling */
    #wrapper {
      position: absolute;
      width: 450px;
      height: 250px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #FFD700, #FFC107);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      border-radius: 8px;
      cursor: pointer;
      z-index: 3;
    }
    /* Chocolate bar container: hidden initially behind the wrapper */
    #chocolate-bar {
      position: absolute;
      width: 450px;
      height: 250px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 10px;
      z-index: 2;
      opacity: 0;
    }
    /* Each chocolate piece */
    .chocolate-piece {
      background: linear-gradient(145deg, #3D1C02, #5a2e0f);
      border-radius: 4px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    /* Message display styling */
    #message {
      position: absolute;
      bottom: 30px;
      width: 100%;
      text-align: center;
      font-family: 'Tangerine', cursive;
      font-size: 3rem;
      color: #9A031E;
      opacity: 0;
      z-index: 5;
    }
    /* Falling chocolates container */
    #falling-chocolates {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 4;
    }
    /* Style for each falling chocolate */
    .falling-chocolate {
      position: absolute;
      width: 30px;
      height: 20px;
      background: linear-gradient(145deg, #3D1C02, #5a2e0f);
      border-radius: 4px;
      box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }
    /* Particle styling (chocolate crumbs) */
    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #3D1C02;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0.8;
    }
    /* Floating heart container */
    #heart-container {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 6;
    }
    /* Floating heart shape */
    .heart {
      position: absolute;
      width: 30px;
      height: 30px;
      background: radial-gradient(circle, rgba(154,3,30,1) 0%, rgba(255,111,97,1) 100%);
      clip-path: polygon(50% 0%, 61% 10%, 75% 15%, 85% 30%, 90% 45%, 85% 60%, 75% 75%, 50% 100%, 25% 75%, 15% 60%, 10% 45%, 15% 30%, 25% 15%, 39% 10%);
      filter: drop-shadow(0 0 8px rgba(255,111,97,1));
    }
  </style>
</head>
<body>
  <div id="animation-container">
    <!-- Gold foil wrapper (click to peel) -->
    <div id="wrapper"></div>
    <!-- Chocolate bar divided into 6 pieces (2 rows x 3 columns) -->
    <div id="chocolate-bar">
      <div class="chocolate-piece" data-message="You're sweeter than chocolate!"></div>
      <div class="chocolate-piece" data-message="Every moment with you melts my heart."></div>
      <div class="chocolate-piece" data-message="Your love is as rich as the finest cocoa."></div>
      <div class="chocolate-piece" data-message="Life is sweeter with you by my side."></div>
      <div class="chocolate-piece" data-message="A bite of love, a taste of joy."></div>
      <div class="chocolate-piece" data-message="You make my world a delicious place."></div>
    </div>
    <!-- Message container -->
    <div id="message"></div>
    <!-- Container for falling chocolates at the end -->
    <div id="falling-chocolates"></div>
    <!-- Container for floating hearts -->
    <div id="heart-container"></div>
  </div>
  
  <script>
    /*****************************
     * Global Variables & Setup  *
     *****************************/
    let activeBite = null;
    let biteTimeout = null;
    
    const wrapper = document.getElementById('wrapper');
    const chocolateBar = document.getElementById('chocolate-bar');
    const messageEl = document.getElementById('message');
    const fallingContainer = document.getElementById('falling-chocolates');
    
    /*****************************
     * Floating Heart Animation  *
     *****************************/
    function createFloatingHeart() {
      const heart = document.createElement('div');
      heart.classList.add('heart');
      // Start at a random horizontal position along the bottom
      heart.style.left = Math.random() * 80 + 10 + '%';
      heart.style.top = '100%';
      document.getElementById('heart-container').appendChild(heart);
      // Animate upward then reset continuously
      gsap.to(heart, {
        y: -window.innerHeight - 50,
        duration: 5 + Math.random() * 3,
        ease: "power1.inOut",
        repeat: -1,
        delay: Math.random() * 2,
        onRepeat: () => {
          heart.style.left = Math.random() * 80 + 10 + '%';
        }
      });
      // Pulsate the heart gently
      gsap.to(heart, {
        scale: 1.2,
        duration: 0.8,
        yoyo: true,
        repeat: -1,
        ease: "power1.inOut"
      });
    }
    
    // Create a few floating hearts for extra charm
    for (let i = 0; i < 5; i++) {
      createFloatingHeart();
    }
    
    /*****************************
     * Wrapper Peel Animation    *
     *****************************/
    wrapper.addEventListener('click', () => {
      // Animate the wrapper "peeling" away: rotate and slide right
      gsap.to(wrapper, {
        duration: 1.5,
        rotationY: 90,
        x: 300,
        ease: "power2.inOut",
        onComplete: () => {
          wrapper.style.display = 'none';
          // Reveal the chocolate bar by fading it in
          gsap.to(chocolateBar, {duration: 1, opacity: 1});
        }
      });
      // Create a fun particle effect as the wrapper peels off
      for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        particle.style.left = (window.innerWidth/2) + 'px';
        particle.style.top = (window.innerHeight/2) + 'px';
        document.body.appendChild(particle);
        gsap.to(particle, {
          duration: 1.5,
          x: (Math.random()-0.5)*200,
          y: (Math.random()-0.5)*200,
          opacity: 0,
          scale: 0,
          ease: "power2.out",
          onComplete: () => { particle.remove(); }
        });
      }
    });
    
    /*****************************
     * Display Romantic Message  *
     *****************************/
    function showMessage(text) {
      messageEl.textContent = text;
      gsap.fromTo(messageEl, {opacity: 0, y: 20}, {opacity: 1, y: 0, duration: 0.5, ease: "power2.out"});
      gsap.to(messageEl, {opacity: 0, delay: 3, duration: 0.5});
    }
    
    /*************************************
     * Chocolate Crumb Particle Effect   *
     *************************************/
    function createCrumbParticles(piece) {
      const rect = piece.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      for (let i = 0; i < 10; i++) {
        const crumb = document.createElement('div');
        crumb.classList.add('particle');
        crumb.style.left = cx + 'px';
        crumb.style.top = cy + 'px';
        document.body.appendChild(crumb);
        gsap.to(crumb, {
          duration: 1,
          x: (Math.random()-0.5)*100,
          y: (Math.random()-0.5)*100,
          opacity: 0,
          scale: 0,
          ease: "power2.out",
          onComplete: () => { crumb.remove(); }
        });
      }
    }
    
    /*************************************
     * Bite Animation for a Chocolate    *
     *************************************/
    function bitePiece(piece) {
      // If another piece is active, remove it immediately
      if (activeBite && activeBite !== piece) {
        activeBite.remove();
        activeBite = null;
        if (biteTimeout) clearTimeout(biteTimeout);
      }
      activeBite = piece;
      // Retrieve the romantic message from the piece's data attribute
      const msg = piece.getAttribute('data-message');
      showMessage(msg);
      
      // Clone the piece to create two halves
      const rect = piece.getBoundingClientRect();
      const pieceClone = piece.cloneNode(true);
      pieceClone.style.position = 'absolute';
      pieceClone.style.left = rect.left + 'px';
      pieceClone.style.top = rect.top + 'px';
      pieceClone.style.margin = 0;
      pieceClone.style.transformOrigin = "center center";
      document.body.appendChild(pieceClone);
      
      // Create left and right halves using CSS clipping
      const leftHalf = pieceClone.cloneNode(true);
      const rightHalf = pieceClone.cloneNode(true);
      leftHalf.style.clipPath = "inset(0 50% 0 0)";
      rightHalf.style.clipPath = "inset(0 0 0 50%)";
      document.body.appendChild(leftHalf);
      document.body.appendChild(rightHalf);
      piece.style.visibility = "hidden";
      
      // Animate the halves moving apart and fading away
      gsap.to(leftHalf, {duration: 1, x: -50, opacity: 0, ease: "power2.out", onComplete: () => { leftHalf.remove(); }});
      gsap.to(rightHalf, {duration: 1, x: 50, opacity: 0, ease: "power2.out", onComplete: () => { rightHalf.remove(); }});
      
      // Emit chocolate crumb particles from the bitten piece
      createCrumbParticles(piece);
      
      // Fade out and remove the original piece after the bite animation
      gsap.to(piece, {duration: 0.5, opacity: 0, delay: 1, onComplete: () => { 
        piece.remove(); 
        checkFinalCelebration(); 
      }});
      
      // Clear the active bite after 10 seconds if no new piece is clicked
      if (biteTimeout) clearTimeout(biteTimeout);
      biteTimeout = setTimeout(() => {
        activeBite = null;
      }, 10000);
    }
    
    // Add click event listeners to each chocolate piece
    const pieces = document.querySelectorAll('.chocolate-piece');
    pieces.forEach(piece => {
      piece.addEventListener('click', (e) => {
        e.stopPropagation();
        bitePiece(piece);
      });
    });
    
    /*************************************
     * Trigger Final Celebration         *
     *************************************/
    function checkFinalCelebration() {
      const remaining = document.querySelectorAll('.chocolate-piece');
      if (remaining.length === 0) {
        setTimeout(finalCelebration, 1000);
      }
    }
    
    // Final celebration: "Happy chocolate day!" and shower of falling chocolates
    function finalCelebration() {
      showMessage("Happy chocolate day!");
      // Create falling chocolate pieces from above
      for (let i = 0; i < 30; i++) {
        const fallChoc = document.createElement('div');
        fallChoc.classList.add('falling-chocolate');
        fallChoc.style.left = Math.random() * window.innerWidth + "px";
        fallChoc.style.top = -50 + "px";
        fallingContainer.appendChild(fallChoc);
        gsap.to(fallChoc, {
          duration: 3 + Math.random() * 2,
          y: window.innerHeight + 50,
          ease: "power2.in",
          onComplete: () => { fallChoc.remove(); }
        });
      }
    }
  </script>
</body>
</html>
